version: "3.8"
services:
  shinyproxy-toolbox:
    image: landscapedatacommons/shinyproxy-toolbox:2.6.1
#    container_name: shinyproxy-toolbox
    deploy:
      mode: replicated
      replicas: 1
      endpoint_mode: vip
      placement:
        max_replicas_per_node: 1
      update_config:
        parallelism: 1
        delay: 10s
        order: start-first
        failure_action: rollback
      restart_policy:
        condition: on-failure
#    restart: on-failure
    networks:
      - shinyproxy-toolbox_default
    ports:
#      - target: 8080
#        published: 80
#        protocol: tcp
#        mode: host
      - 80:8080
    volumes:
#      - /var/run/docker.sock:/var/run/docker.sock
      - ./shinyproxy-logs/server:/log
      - ./shinyproxy-logs/container:/container-logs
      - ./application.yml:/opt/shinyproxy/application.yml
  benchmark-exploration-tool:
    image: landscapedatacommons/benchmark-exploration-tool:4.0.5
#    container_name: benchmark-exploration-tool
    deploy:
      mode: replicated
      replicas: 1
      endpoint_mode: vip
      placement:
        max_replicas_per_node: 1
      update_config:
        parallelism: 1
        delay: 10s
        order: start-first
        failure_action: rollback
    networks:
      - shinyproxy-toolbox_default
    ports:
#      - target: 3839
#        published: 3839
#        protocol: tcp
#        mode: host
      - 3839:3839
  balanced-design-tool:
    image: landscapedatacommons/balanced-design-tool:4.0.5
#   container_name: balanced-design-tool
    deploy:
      mode: replicated
      replicas: 1
      endpoint_mode: vip
      placement:
        max_replicas_per_node: 1
      update_config:
        parallelism: 1
        delay: 10s
        order: start-first
        failure_action: rollback
    networks:
      - shinyproxy-toolbox_default
    ports:
#     - target: 3838
#       published: 3838
#       protocol: tcp
#       mode: host
     - 3838:3838

networks:
  shinyproxy-toolbox_default:
    driver: overlay
    attachable: true
    name: shinyproxy-toolbox_default