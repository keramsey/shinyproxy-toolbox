version: "3.9"
services:
  shinyproxy-toolbox:
    image: landscapedatacommons/shinyproxy-toolbox:2.6.1
#    container_name: shinyproxy-toolbox
    deploy:
      mode: replicated
      replicas: 2
      endpoint_mode: vip
      placement:
        max_replicas_per_node: 1
      update_config:
        parallelism: 1
        delay: 10s
        order: start-first
        failure_action: rollback
      restart_policy:
        condition: replicated
    restart: on-failure
    networks:
      - toolbox-net
    ports:
      - 8092:8080
    volumes:
#      - /var/run/docker.sock:/var/run/docker.sock
      - ./shinyproxy-logs/server:/log
      - ./shinyproxy-logs/container:/container-logs
      - ./application.yml:/opt/shinyproxy/application.yml
  benchmark-exploration-tool:
    image: landscapedatacommons/benchmark-exploration-tool:4.0.5
    deploy:
      mode: replicated
      replicas: 2
      endpoint_mode: vip
      placement:
        max_replicas_per_node: 1
      update_config:
        parallelism: 1
        delay: 10s
        order: start-first
        failure_action: rollback
      restart_policy:
        condition: replicated
#    container_name: benchmark-exploration-tool
    networks:
      - toolbox-net
  balanced-design-tool:
    image: landscapedatacommons/balanced-design-tool:4.0.5
    deploy:
      mode: replicated
      replicas: 2
      endpoint_mode: vip
      placement:
        max_replicas_per_node: 1
      update_config:
        parallelism: 1
        delay: 10s
        order: start-first
        failure_action: rollback
      restart_policy:
        condition: replicated
#   container_name: balanced-design-tool
    networks:
      - toolbox-net
networks:
  toolbox-net:
    driver: bridge
    name: toolbox-net